<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.0.5" />
<title>Swift/T Sites Guide</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}



/* Swift/T guide customizations */

a:visited {
  color: gray;
}
h5 {
  font-size: 0.8em;
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:875px">
<div id="header">
<h1>Swift/T Sites Guide</h1>
<span id="author">Justin M. Wozniak</span><br />
<span id="email"><code>&lt;<a href="mailto:woz@anl.gov">woz@anl.gov</a>&gt;</code></span><br />
<span id="revnumber">version 1.5.0,</span>
<span id="revdate">May 2022</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_how_to_use_this_guide">How to use this guide</h2>
<div class="sectionbody">
<div class="paragraph"><p>This manual provides a reference on how to run Swift/Turbine
programs on a variety of systems.  It also contains an index of sites
maintained by the Swift/T team for use by Turbine.</p></div>
<div class="paragraph"><p>For each machine, a <strong>public installation</strong> and/or a <strong>build procedure</strong> will
be provided.  The user need follow only one set of directions.</p></div>
<div class="paragraph" id="login_node"><p>A <strong>login node installation</strong> may be available on certain systems.  This
will run Swift/T on the login node of that system.  This only
acceptable for short debugging runs of 1 minute or less.  If you do
this, you should run <code>swift-t</code> or <code>turbine</code> under the <code>nice</code> command.
It will affect other users so please be cautious when using this mode
for debugging.</p></div>
<div class="sect2">
<h3 id="_public_installations">Public installations</h3>
<div class="paragraph"><p>These are maintained by the Swift/T team.  Because they may become out
of date after a release, the release version and a timestamp are
recorded below.</p></div>
<div class="paragraph"><p>To request maintenance on a public installation, simply email<br />
<a href="mailto:swift-t-user@googlegroups.com">swift-t-user@googlegroups.com</a> .</p></div>
</div>
<div class="sect2">
<h3 id="_build_procedures">Build procedures</h3>
<div class="paragraph"><p>The build procedure is based on the installation process
described in the <a href="./guide.html">Swift/T Guide</a>.  You
should follow that build procedure, and use this
guide for information on specific configuration
settings for your system.</p></div>
<div class="paragraph"><p>The settings are generally implemented by modifying the
<code>swift-t-settings.sh</code> configuration script.  In some cases,
where the setting is not configurable through <code>swift-t-settings.sh</code>,
it may be necessary to directly modify the <code>configure</code> or <code>make</code>
command lines by following the manual build process, or by modifying
build scripts under the <code>build</code> subdirectory
(e.g. <code>turbine-build.sh</code>).</p></div>
</div>
<div class="sect2">
<h3 id="_version_numbers">Version numbers</h3>
<div class="paragraph"><p>The component version numbers that correspond together to make up a
Swift/T release may be found on the
<a href="./downloads.html">Downloads</a> page.</p></div>
</div>
<div class="sect2">
<h3 id="_freshness">Freshness</h3>
<div class="paragraph"><p>These instructions may become stale for various reasons.  For example,
system administrators may update directory locations, breaking these
instructions.  Thus, we mark <strong>As of:</strong> dates on the instructions for
each system.</p></div>
<div class="paragraph"><p>To report a problem, simply email <a href="mailto:swift-t-user@googlegroups.com">swift-t-user@googlegroups.com</a> .</p></div>
</div>
<div class="sect2">
<h3 id="_for_more_information">For more information</h3>
<div class="ulist"><ul>
<li>
<p>
See the <a href="./guide.html">Swift/T Guide</a> for more information about Swift/T.
</p>
</li>
<li>
<p>
Join the <a href="https://groups.google.com/forum/#!forum/swift-t-user"><code>swift-user</code> mailing list</a>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quickstart">Quickstart</h2>
<div class="sectionbody">
<div class="paragraph"><p>On a scheduled system, you typically need to simply:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Set some environment variables, such as your queue, project account, etc.
</p>
</li>
<li>
<p>
Run Swift/T with the name of the scheduler, e.g.:
</p>
<div class="listingblock">
<div class="content">
<pre><code>$ swift-t -m pbs workflow.swift</code></pre>
</div></div>
</li>
</ol></div>
<div class="paragraph"><p>The <a href="#variables">environment variables</a> are typically placed in a wrapper shell
script that sets the environment variables for your case and finally
calls <code>swift-t</code>.  Alternatively, they may be placed in a
<a href="#settings_file">settings file</a>.</p></div>
<div class="paragraph"><p>The <code>swift-t</code> command will submit your job to the given scheduler and
run it.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_swift_turbine_compilation">Swift-Turbine compilation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Swift/T usage starts with developing and testing a Swift/T script.
See the main <a href="./guide.html">Swift/T usage guide</a> for more
information.</p></div>
<div class="paragraph"><p>In short, you use STC to compile the Swift script into a format that
the runtime, Turbine, can run.  You may compile and run in one step
with <code>swift-t</code> or run <code>stc</code> and <code>turbine</code> separately.</p></div>
<div class="paragraph"><p>When running on a big HPC machine, it may be difficult to get STC
(a Java-based program) running.  STC output (<code>program.tic</code>) is
platform-independent.  You may run STC to develop and debug your
script on your local workstation, then simply copy <code>program.tic</code> to
the big machine for execution.  Just make sure that the STC and
Turbine versions are compatible (the same release).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_turbine_as_mpi_program">Turbine as MPI program</h2>
<div class="sectionbody">
<div class="paragraph"><p>Turbine is a moderately complex MPI program.  It is essentially a Tcl
library that glues together multiple C-based systems, including MPI,
ADLB, and the Turbine dataflow library.</p></div>
<div class="paragraph"><p>Running Turbine on a MPI-enabled system works as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
Compilation and installation: This builds the Turbine libraries and
  links with the system-specific MPI library.  STC must also be
  informed of the Turbine installation to access correct built-in
  function information
</p>
</li>
<li>
<p>
Run-time configuration: The startup job submission script locates
  the Turbine installation and reads configuration information
</p>
</li>
<li>
<p>
Process launch: The Tcl shell, <code>tclsh</code>, is launched in parallel and
  configuration information is passed to it so it can find the
  libraries. The Tcl program script is the STC-generated user program
  file.  The MPI library enables communication among the <code>tclsh</code>
  processes.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Each of the systems below follows this basic outline.</p></div>
<div class="paragraph"><p>On simpler systems, use the <code>turbine</code> program.  This is a small shell
script wrapper that configures Turbine and essentially runs:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mpiexec tclsh program.tic</code></pre>
</div></div>
<div class="paragraph"><p>On more complex, scheduled systems, users do not invoke <code>mpiexec</code>
directly; Turbine run scripts are provided by Swift/T.</p></div>
<div class="sect2">
<h3 id="_turbine_pilot">Turbine Pilot</h3>
<div class="paragraph"><p>The <code>turbine-pilot</code> program can be used to run Swift/T interactively
on the compute nodes of a scheduled system in an interactive
allocation.  This mode of operation does not attempt to submit a job
to the scheduler, it assumes you have already done that.</p></div>
<div class="paragraph"><p>Simply compile your workflow with <code>stc</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ stc workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p>which produces <code>workflow.tic</code> .  Then run:</p></div>
<div class="sect3">
<h4 id="_cray_alps_system">Cray ALPS system</h4>
<div class="listingblock">
<div class="content">
<pre><code># Inside the interactive job
$ aprun -B turbine-pilot workflow.tic &lt;ARGUMENTS...&gt;</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_slurm_system">SLURM system</h4>
<div class="listingblock">
<div class="content">
<pre><code># Inside the interactive job
$ srun -n 4 turbine-pilot workflow.tic &lt;ARGUMENTS...&gt;</code></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scheduled_systems">Submitting Turbine jobs on scheduled systems</h2>
<div class="sectionbody">
<div class="paragraph"><p>On scheduled systems (PBS, SLURM, LSF, Cobalt, etc.), Turbine is launched
with a customized <em>run script</em> (<code>turbine-&lt;name&gt;-run</code>) that launches Turbine
on that system.  This produces a batch script if necessary and submits
it with the job submission program (e.g., <code>qsub</code>).</p></div>
<div class="sect2">
<h3 id="_turbine_run_scripts">Turbine run scripts</h3>
<div class="paragraph"><p>Turbine includes the following scheduler support,
implemented with the associated shell run scripts:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
PBS
</dt>
<dd>
<p>
<code>turbine-pbs-run.zsh</code>
</p>
</dd>
<dt class="hdlist1">
Cobalt
</dt>
<dd>
<p>
<code>turbine-cobalt-run.zsh</code>
</p>
</dd>
<dt class="hdlist1">
Cray/APRUN
</dt>
<dd>
<p>
<code>turbine-cray-run.zsh</code> (PBS with Cray&#8217;s <code>aprun</code>)
</p>
</dd>
<dt class="hdlist1">
SLURM
</dt>
<dd>
<p>
<code>turbine-slurm-run.zsh</code>
</p>
</dd>
<dt class="hdlist1">
Theta
</dt>
<dd>
<p>
<code>turbine-theta-run.zsh</code> (Cobalt with Cray&#8217;s <code>aprun</code>)
</p>
</dd>
<dt class="hdlist1">
ThetaGPU
</dt>
<dd>
<p>
<code>turbine-theta-run.zsh</code> (Cobalt with <code>mpirun</code>)
</p>
</dd>
<dt class="hdlist1">
LSF
</dt>
<dd>
<p>
<code>turbine-lsf-run.zsh</code>
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Each script accepts input via environment variables and command-line options.</p></div>
<div class="paragraph"><p>The <code>swift-t</code> and <code>turbine</code> programs have a <code>-m</code> (machine) option that accepts
<code>pbs</code>, <code>cobalt</code>, <code>cray</code>, <code>lsf</code>, <code>theta</code>, or <code>slurm</code>.</p></div>
<div class="paragraph"><p>A typical invocation is (one step compile-and-run):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m pbs -n 96 -s settings.sh program.swift</code></pre>
</div></div>
<div class="paragraph"><p>or (just compile):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>stc program.swift</code></pre>
</div></div>
<div class="paragraph"><p>or (just run):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>turbine -m pbs -n 96 -s settings.sh program.tic</code></pre>
</div></div>
<div class="paragraph"><p>or (just run):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>turbine-pbs-run.zsh -n 96 -s settings.sh program.tic</code></pre>
</div></div>
<div class="paragraph"><p>which are equivalent.</p></div>
<div class="paragraph"><p><code>program.tic</code> is the output of STC and <code>settings.sh</code> contains:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export QUEUE=bigqueue
export PPN=8</code></pre>
</div></div>
<div class="paragraph"><p>which would run <code>program.tic</code> in 96 MPI processes on 12 nodes (8
processes per node), submitted by PBS to queue <code>bigqueue</code>.</p></div>
</div>
<div class="sect2">
<h3 id="variables">Turbine scheduler variables</h3>
<div class="paragraph"><p>For scheduled systems, Turbine accepts a common set of environment
variables.  These may be set by:</p></div>
<div class="ulist"><ul>
<li>
<p>
Simply setting them in the calling environment
</p>
</li>
<li>
<p>
Setting them in the environment <a href="#settings_file">settings file</a>
</p>
</li>
<li>
<p>
Passing them in via the flag <code>-e</code> .
</p>
</li>
</ul></div>
<!-- end list -->
<div class="dlist"><dl>
<dt class="hdlist1">
<code>PROCS</code>
</dt>
<dd>
<p>
Number of processes to use
</p>
</dd>
<dt class="hdlist1">
<code>PPN</code>
</dt>
<dd>
<p>
Number of processes per node
</p>
</dd>
<dt class="hdlist1">
<code>PROJECT</code>
</dt>
<dd>
<p>
The project name to use with the system scheduler
</p>
</dd>
<dt class="hdlist1">
<code>QUEUE</code>
</dt>
<dd>
<p>
Name of queue in which to run
</p>
</dd>
<dt class="hdlist1">
<code>WALLTIME</code>
</dt>
<dd>
<p>
Wall time argument to pass to scheduler, typically <code>HH:MM:SS</code>
</p>
</dd>
<dt class="hdlist1">
<code>TURBINE_OUTPUT</code>
</dt>
<dd>
<p>
The run directory for the workflow.
Turbine will create this directory if it does not exist.
If unset, a default value is automatically set.
The TIC file is copied here before execution.
Normally, this is unique to a Swift/T workflow execution,
and starts out empty.
</p>
<div class="paragraph"><p>Note that if <code>TURBINE_OUTPUT</code> is set to the same directory as
the workflow source directory, your <code>*.tic</code> file may be
auto-deleted by <code>swift-t</code>; use <code>swift-t -o</code> to prevent this.
If <code>TURBINE_OUTPUT</code> is shared by multiple concurrent
Swift/T workflows, conflicts may occur.</p></div>
</dd>
<dt class="hdlist1">
<code>TURBINE_OUTPUT_ROOT</code>
</dt>
<dd>
<p>
Directory under which Turbine will automatically create
<code>TURBINE_OUTPUT</code> if necessary
</p>
</dd>
<dt class="hdlist1">
<code>TURBINE_OUTPUT_FORMAT</code>
</dt>
<dd>
<p>
Allows customization of the automatic output directory creation.
See <a href="#turbine_output">Turbine output</a>
</p>
</dd>
</dl></div>
<a name="turbine_bash_l"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>TURBINE_BASH_L=0</code>
</dt>
<dd>
<p>
By default, Swift/T creates a Bash script for job submission that
will be invoked with <code>#!/bin/bash -l</code> .
Set <code>TURBINE_BASH_L=0</code> to run with <code>#!/bin/bash</code> .
This can avoid problems with environment modules on certain systems.
</p>
</dd>
</dl></div>
<a name="turbine_directive"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>TURBINE_DIRECTIVE</code>
</dt>
<dd>
<p>
Paste the given text into the submit script just after the scheduler
directives.
Allows users to insert, e.g., reservation
information into the script.
For example, on PBS, this text will be inserted just after the last
default <code>#PBS</code> .
</p>
</dd>
</dl></div>
<a name="turbine_prelaunch"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>TURBINE_PRELAUNCH</code>
</dt>
<dd>
<p>
Paste the given text into the submit script.
Allows users to insert, e.g., <code>module&nbsp;load</code> statements
into the script.
These shell commands will be inserted just before the execution is
launched via <code>mpiexec</code>, <code>aprun</code>, or equivalent.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="_limited_support">Limited support</h4>
<div class="paragraph"><p>These recently developed features are not yet available for all
schedulers, feel free to request implementation.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>TURBINE_SBATCH_ARGS</code>
</dt>
<dd>
<p>
Optional arguments passed to <code>sbatch</code>.  These arguments may include
<code>--exclusive</code> and <code>--constraint=&#8230;</code>, etc.  Supported systems: <code>slurm</code>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Mail</strong></p></div>
<div class="paragraph"><p>(Currently supported systems: <code>cobalt</code>, <code>slurm</code>, <code>theta</code>)</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>MAIL_ENABLED</code>
</dt>
<dd>
<p>
If 1, send email on job completion.
</p>
</dd>
<dt class="hdlist1">
<code>MAIL_ADDRESS</code>
</dt>
<dd>
<p>
If <code>MAIL_ENABLED</code>, send the email to the given address.
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="variables_other">Other settings</h4>
<div class="paragraph"><p>The <a href="http://swift-lang.github.io/swift-t/guide.html#turbine_env">Turbine
environment variable</a> <code>TURBINE_LAUNCH_OPTIONS</code> will be applied to
<code>mpiexec</code>, <code>srun</code>, or <code>aprun</code> as appropriate.</p></div>
</div>
<div class="sect3">
<h4 id="automatic_env">Automatic environment variables</h4>
<div class="paragraph"><p>These variables are automatically passed to the job, and are available
in Swift/T via <code>getenv()</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>PROJECT</code>
</p>
</li>
<li>
<p>
<code>WALLTIME</code>
</p>
</li>
<li>
<p>
<code>QUEUE</code>
</p>
</li>
<li>
<p>
<code>TURBINE_OUTPUT</code>
</p>
</li>
<li>
<p>
<code>TURBINE_JOBNAME</code>
</p>
</li>
<li>
<p>
<code>TURBINE_STDOUT</code>
</p>
</li>
<li>
<p>
<code>TURBINE_LOG</code>
</p>
</li>
<li>
<p>
<code>TURBINE_DEBUG</code>
</p>
</li>
<li>
<p>
<code>ADLB_DEBUG</code>
</p>
</li>
<li>
<p>
<code>ADLB_TRACE</code>
</p>
</li>
<li>
<p>
<code>MPI_LABEL</code>
</p>
</li>
<li>
<p>
<code>TURBINE_WORKERS</code>
</p>
</li>
<li>
<p>
<code>ADLB_SERVERS</code>
</p>
</li>
<li>
<p>
<code>TCLLIBPATH</code>
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content"><code>TCLLIBPATH</code> should not be set directly by the user,
see <a href="guide.html#swift_path"><code>SWIFT_PATH</code></a></td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content"><code>LD_LIBRARY_PATH</code> may be explicity set by the user.  Normally
this is already set but customizations may be needed when running with
Python, R, or other libraries.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="options">Turbine scheduler script options</h3>
<div class="paragraph"><p>For scheduled systems, Turbine accepts a common set of command line options.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>-d &lt;directory&gt;</code>
</dt>
<dd>
<p>
Set the Turbine output directory.  (Overrides <code>TURBINE_OUTPUT</code>).
</p>
</dd>
</dl></div>
<a name="output_token_file"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>-D &lt;file&gt;</code>
</dt>
<dd>
<p>
Writes the value of <code>TURBINE_OUTPUT</code> into given <code>file</code>.
This is a convenience feature for shell scripting.
Provide <code>/dev/null</code> to disable this feature.
</p>
</dd>
<dt class="hdlist1">
<code>-e &lt;key&gt;=&lt;value&gt;</code>
</dt>
<dd>
<p>
Set an environment variable in the job environment.  This may be used
multiple times.  <a href="#automatic_env">Automatic environment variables</a>
need not be specified here.
</p>
</dd>
</dl></div>
<a name="init_script"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>-i &lt;script&gt;</code>
</dt>
<dd>
<p>
Set an <em>initialization script</em> to run before launching Turbine.  This
script will have <code>TURBINE_OUTPUT</code> in the environment, so you may
perform additional configuration just before job launch.
Other available environment variables include <code>PROCS</code> (the total
number of MPI processes), <code>TURBINE_WORKERS</code> (the number of Turbine
worker processes), <code>SCRIPT</code> and <code>ARGS</code> (the Swift/Turbine command),
<code>WALLTIME</code>, <code>NODES</code>, <code>PPN</code>, etc.  See <code>run-init.zsh</code> for other
variables.  Also, all environment variables from <code>turbine-config.sh</code>
(i.e., Turbine installation information) are available.  The
initialization script is usually a simple shell script but can be any
program, use the Unix hash bang (e.g., <code>#!/bin/sh</code>) syntax as usual in
shell scripting.
</p>
</dd>
<dt class="hdlist1">
<code>-n &lt;procs&gt;</code>
</dt>
<dd>
<p>
Number of processes.  (Overrides <code>PROCS</code>.)
</p>
</dd>
<dt class="hdlist1">
<code>-o &lt;directory&gt;</code>
</dt>
<dd>
<p>
Set the Turbine output directory root, in which
default Turbine output directories are automatically created based on
the date.  (Overrides <code>TURBINE_OUTPUT_ROOT</code>.)
</p>
</dd>
</dl></div>
<a name="settings_file"></a>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>-s &lt;script&gt;</code>
</dt>
<dd>
<p>
Source this <em>settings file</em> for environment variables.  These
variables override any other <a href="#variables">Turbine scheduler variables</a>, including <code>TURBINE_OUTPUT</code>.  You may place arbitrary
shell code in this script.  This script is run before the
initialization script (<code>turbine -i</code>).  This is an alternative to
placing the environment variables in a wrapper script.
</p>
</dd>
<dt class="hdlist1">
<code>-t &lt;time&gt;</code>
</dt>
<dd>
<p>
Set scheduler walltime.  The argument format is passed
through to the scheduler
</p>
</dd>
<dt class="hdlist1">
<code>-V</code>
</dt>
<dd>
<p>
Make script verbose.  This typically just applies <code>set -x</code>,
allowing you to inspect variables and arguments as passed to the
system scheduler (e.g., <code>qsub</code>).
</p>
</dd>
<dt class="hdlist1">
<code>-x</code>
</dt>
<dd>
<p>
Use <code>turbine_sh</code> launcher with compiled-in libraries instead of <code>tclsh</code>
       (reduces number of files that must be read from file system).
</p>
</dd>
<dt class="hdlist1">
<code>-X</code>
</dt>
<dd>
<p>
Run standalone Turbine executable
        (created by <a href="guide.html#mkstatic"><code>mkstatic.tcl</code></a>) instead of
        <code>program.tic</code>.
</p>
</dd>
<dt class="hdlist1">
<code>-Y</code>
</dt>
<dd>
<p>
Create a batch submission file, report its name,
       and exit before submitting it.  Useful for users that need
       to edit the batch file before submission.<br />
       (Currently supported systems: <code>slurm</code>)
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="turbine_output">Turbine output directory</h3>
<div class="paragraph"><p>The working directory (<code>PWD</code>) for the job is called <code>TURBINE_OUTPUT</code>.</p></div>
<div class="paragraph"><p>If the user sets this environment variable, Turbine uses it.</p></div>
<div class="paragraph"><p>If the user does not set this variable, Turbine will select one based
on the date and report it.  The automatically selected directory will
be placed under <code>TURBINE_OUTPUT_ROOT</code>, which defaults to
<code>$HOME/turbine-output</code>.  The compiled user Swift/T workflow program
(TIC) will be copied to <code>TURBINE_OUTPUT</code> before submission.  Standard
output and error goes to <code>TURBINE_OUTPUT/output.txt</code>.</p></div>
<div class="paragraph"><p>The automatically created Turbine output directory <code>TURBINE_OUTPUT</code> is
generated by passing <code>TURBINE_OUTPUT_FORMAT</code> to the <code>date</code> command.
The default value is <code>%Y/%m/%d/%H/%M/%S</code>, that is,
<code>year/month/day/hour/minute/second</code> (see <code>man date</code> for more options).
An additional option is provided by Turbine is <code>%Q</code>, which puts a
unique number in that spot.  <code>TURBINE_OUTPUT_PAD</code> sets the minimum
field width of the integer put into the spot, defaulting to 3.</p></div>
<div class="paragraph"><p>For example, on a Wednesday, <code>TURBINE_OUTPUT_ROOT=/scratch</code>,
<code>TURBINE_OUTPUT_FORMAT=%A/%Q</code>, <code>TURBINE_OUTPUT_PAD=1</code> would run
subsequent Swift/T jobs in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/scratch/Wednesday/1
/scratch/Wednesday/2
/scratch/Wednesday/3</code></pre>
</div></div>
<div class="paragraph"><p>Use an <a href="#init_script">init script</a> to set up the <code>TURBINE_OUTPUT</code>
directory before the job starts.</p></div>
<div class="paragraph"><p>When you run any scheduled job, by default, Turbine stores a soft link
to <code>TURBINE_OUTPUT</code> in <code>$PWD/turbine-output</code>.
This is a convenience feature for shell scripting.
You can change this link name by assigning it to environment variable
<code>TURBINE_OUTPUT_SOFTLINK</code>, or disable it by setting
<code>TURBINE_OUTPUT_SOFTLINK=/dev/null</code>.  See also the
<a href="#output_token_file">Turbine output directory file</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_x86_clusters">x86 clusters</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="generic_clusters">Generic clusters</h3>
<div class="paragraph"><p>This is the simplest method to run Turbine.</p></div>
<div class="sect3">
<h4 id="_build_procedure">Build procedure</h4>
<div class="paragraph"><p>The <code>turbine-build.sh</code> script should work without any special configuration.</p></div>
<div class="paragraph"><p>To run, simply build a MPI hosts file and pass that to Turbine, which
will pass it to <code>mpiexec</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>turbine -l -n 3 -f hosts.txt program.tic</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_mcs_compute_servers">MCS compute servers</h3>
<div class="paragraph"><p>Compute servers at MCS Division, ANL.
Operates as a generic cluster (see above).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>echo crush.mcs.anl.gov &gt;  hosts.txt
echo crank.mcs.anl.gov &gt;&gt; hosts.txt
swift-t -l -n 3 -t f:hosts.txt workflow.swift</code></pre>
</div></div>
<div class="sect3">
<h4 id="_public_installation">Public installation</h4>
<div class="paragraph"><p><strong>As of:</strong> <code>master</code>, 2017/07/19</p></div>
<div class="paragraph"><p>MCS users are welcome to use this installation.  It has Python 2.7.10
and R 3.4.1 .</p></div>
<div class="paragraph"><p>Simply add Swift/T and Python to your <code>PATH</code>:</p></div>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/x86_64/swift-t/stc/bin</code>
</p>
</li>
<li>
<p>
Python: <code>~wozniak/Public/x86_64/Python-2.7.10/bin</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Add Python and R to your <code>LD_LIBRARY_PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export LD_LIBRARY_PATH=$HOME/Public/sfw/x86_64/R-3.4.1/lib/R/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=$HOME/Public/sfw/x86_64/Python-2.7.10/lib:$LD_LIBRARY_PATH</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_instructions">Build instructions</h4>
<div class="ulist"><ul>
<li>
<p>
Check that <code>which mpicc</code> is <code>/usr/bin/mpicc</code>
</p>
</li>
<li>
<p>
Configure c-utils as usual
</p>
</li>
<li>
<p>
Configure ADLB with <code>CC=mpicc</code>
</p>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>  --with-python-exe=/home/wozniak/Public/sfw/x86_64/Python-2.7.10/bin/python
  --with-r=/home/wozniak/Public/sfw/x86_64/R-3.4.1/lib/R</code></pre>
</div></div>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_cooley">Cooley</h3>
<div class="paragraph"><p><a href="https://www.alcf.anl.gov/user-guides/cooley">Cooley</a> is a large cluster
at the ALCF.</p></div>
<div class="sect3">
<h4 id="_public_installation_2">Public installation</h4>
<div class="paragraph"><p><strong>As of:</strong> 2019-07-29</p></div>
<div class="paragraph"><p>This installation has Python with TensorFlow 0.10.0rc0 .</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/soft/analytics/conda/env/Candle_ML/bin
~wozniak/Public/sfw/x86_64/swift-t/stc/bin</code></pre>
</div></div>
<div class="paragraph"><p>Run on the login nodes with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ nice swift-t ...</code></pre>
</div></div>
<div class="paragraph"><p>Run on the compute nodes with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export MODE=cluster QUEUE=default PROJECT=...
$ swift-t -m cobalt ...</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_instructions_2">Build instructions</h4>
<div class="paragraph"><p>Dependencies are in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/x86_64/mpich-3.2-gcc-8.2.0
~wozniak/Public/sfw/x86_64/tcl-8.6.6-global-gcc-4.8.1</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Add these dependencies to <code>PATH</code>.
</p>
</li>
<li>
<p>
Use the <a href="guide.html#install_source"><code>dev/build</code> scripts</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_midway">Midway</h3>
<div class="paragraph"><p>Midway is a mid-sized SLURM cluster at the University of Chicago</p></div>
<div class="paragraph"><p>On Midway/SLURM, set environment variable <code>PROJECT</code> as you would for
<code>--account</code>, and environment variable <code>QUEUE</code> as you would for
<code>--partition</code>.  See <a href="#variables">Turbine scheduler variables</a>.</p></div>
<div class="paragraph"><p>In SLURM, Swift/T supports additional optional environment variable
<code>TURBINE_SBATCH_ARGS</code>.  These arguments, on Midway, may include
<code>--exclusive</code> and <code>--constraint=ib</code>.  The internally generated
<code>sbatch</code> command is logged in <code>$TURBINE_OUTPUT/sbatch.txt</code>.
For example,</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export TURBINE_SBATCH_ARGS="--exclusive --constraint=ib"
$ swift-t -n 4 -m slurm program.swift ...
...
$ cat $TURBINE_OUTPUT/sbatch.txt
...
sbatch --output=... --exclusive --constraint=ib .../turbine-slurm.sh</code></pre>
</div></div>
<div class="sect3">
<h4 id="_public_installation_3">Public installation</h4>
<div class="ulist"><ul>
<li>
<p>
Compute nodes
</p>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export PPN=16 # or desired number of Processes Per Node
swift-t -m slurm ... # or
turbine -m slurm ...</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Compute nodes: <strong>As of:</strong> master - 2016/06/14
</p>
<div class="ulist"><ul>
<li>
<p>
System OpenMPI:
</p>
<div class="ulist"><ul>
<li>
<p>
STC:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>~wozniak/Public/sfw/compute/gcc/swift-t-openmpi/stc/bin</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Turbine:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>~wozniak/Public/sfw/compute/gcc/swift-t-openmpi/turbine/bin</code>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Compute nodes with Python 2.7.10: <strong>As of:</strong> master - 2016/08/19
</p>
<div class="ulist"><ul>
<li>
<p>
Vanilla MPICH:
</p>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/sfw/compute/gcc/swift-t-mpich-py/stc/bin</code>
</p>
</li>
<li>
<p>
Turbine: <code>~wozniak/Public/sfw/compute/gcc/swift-t-mpich-py/stc/bin</code>
</p>
</li>
<li>
<p>
Python: <code>~wozniak/Public/sfw/Python-2.7.10/bin</code>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Login node:
</p>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>nice swift-t -n 2 program.swift</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Vanilla MPICH, Python 2.7.10: <strong>As of:</strong> master - 2016/06/14
</p>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/sfw/login/gcc/swift-t/stc/bin</code>
</p>
</li>
<li>
<p>
Turbine: <code>~wozniak/Public/sfw/login/gcc/swift-t/turbine/bin</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Vanilla MPICH, Python 3.6.1: <strong>As of:</strong> master - 2017/03/22
</p>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/sfw/login/gcc/swift-t-py-3.6.1/stc/bin</code>
</p>
</li>
<li>
<p>
Turbine: <code>~wozniak/Public/sfw/login/gcc/swift-t-py-3.6.1/turbine/bin</code>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_2">Build procedure</h4>
<div class="ulist"><ul>
<li>
<p>
Midway uses MVAPICH or OpenMPI.
</p>
</li>
<li>
<p>
Put <code>mpicc</code> in your <code>PATH</code>
</p>
</li>
<li>
<p>
Use these settings in <code>swift-t-settings.sh</code>:
</p>
<div class="listingblock">
<div class="content">
<pre><code>export LDFLAGS="-Wl,-rpath -Wl,/software/openmpi-1.6-el6-x86_64/lib"
MPI_VERSION=2
MPI_LIB_NAME=mpi</code></pre>
</div></div>
</li>
<li>
<p>
Or if doing a manual build with <code>configure</code> and make:
</p>
<div class="ulist"><ul>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>LDFLAGS="-Wl,-rpath -Wl,/software/openmpi-1.6-el6-x86_64/lib" --enable-mpi-2</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code> --with-mpi-lib-name=mpi</code></pre>
</div></div>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_bebop">Bebop</h3>
<div class="paragraph"><p><a href="http://www.lcrc.anl.gov/about/bebop">Bebop</a> is a 1024-node x86
cluster at ANL.  It uses SLURM.</p></div>
<div class="sect3">
<h4 id="_public_installation_4">Public installation</h4>
<div class="sect4">
<h5 id="_regular_build">Regular build</h5>
<div class="paragraph"><p><strong>As of:</strong> Master, 2019-06-18</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/bebop/compute/swift-t/2019-06-14/stc/bin
~wozniak/Public/sfw/bebop/compute/swift-t/2019-06-14/turbine/bin</code></pre>
</div></div>
<div class="paragraph"><p><strong>Login node:</strong></p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ nice swift-t workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p><strong>Compute nodes:</strong></p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ swift-t -m slurm workflow.swift</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="bebop_spack">Spack</h5>
<div class="paragraph"><p><strong>As of:</strong> Master, 2021-02-24</p></div>
<div class="paragraph"><p>This installation uses Spack for Swift/T,
and Anaconda for most dependencies.</p></div>
<div class="paragraph"><p>Load from Spack:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ source ~woz/Public/sfw/bebop/spack/mvapich2/share/spack/setup-env.sh
$ spack load stc turbine
$ swift-t -v
...
 using MPI:    /blues/.../spack-0.10.1/.../gcc-7.1.0/mvapich2-2.3a ... "MPICH"
 using Tcl:    /home/woz/Public/sfw/bebop/anaconda3/bin/tclsh8.6
 using Python: /home/woz/Public/sfw/bebop/anaconda3/lib python3.8
 using R:      /gpfs/fs1/home/woz/Public/sfw/bebop/anaconda3/lib/R</code></pre>
</div></div>
<div class="paragraph"><p>Run as noted for Bebop compute nodes above.<br />
This installation also supports <a href="#_turbine_pilot">Turbine Pilot</a>.</p></div>
<div class="paragraph"><p>See this for build hints:
<code>~woz/Public/sfw/bebop/spack/mvapich2/etc/spack/packages.yaml</code></p></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_instructions_3">Build instructions</h4>
<div class="paragraph"><p>These prerequisites are available and have been tested:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>MPI:    ~wozniak/Public/sfw/mpich-3.1.2
Tcl:    ~wozniak/Public/sfw/tcl-8.6.5
Python: /blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/python-3.6.5-lvrzbkyyf53gqe5xwp6xsp7xjzajdbbu
R:      ~/Public/sfw/bebop/R-3.4.3</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Use the <code>dev/build/build-swift-t.sh</code> method
</p>
</li>
<li>
<p>
Enable the <code>module load gcc/7.1.0-4bgguyp</code> in <code>swift-t-settings.sh</code>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_washington">Washington</h3>
<div class="paragraph"><p>Washington is a single node deep learning machine for CELS.</p></div>
<div class="sect3">
<h4 id="_public_installation_5">Public installation</h4>
<div class="paragraph"><p><strong>As of:</strong> 2019-05-29</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/swift-t/2019-05-23/stc/bin/swift-t</code></pre>
</div></div>
<div class="paragraph"><p>Run as usual on a local machine.</p></div>
<div class="paragraph"><p>This installation has Python and R enabled.</p></div>
</div>
<div class="sect3">
<h4 id="_dependencies">Dependencies</h4>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/anaconda3
~wozniak/Public/sfw/ant-1.10.5
~wozniak/Public/sfw/jdk-1.8.0_211
~wozniak/Public/sfw/mpich-3.2.1
~wozniak/Public/sfw/R-3.5.3
~wozniak/Public/sfw/tcl-8.6.8-global
~wozniak/Public/sfw/EQ-R</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_3">Build procedure</h4>
<div class="paragraph"><p>Use the <code>dev/build/build-swift-t.sh</code> method.
Simply set the MPI, Tcl (and optionally Python and R) locations in
<code>swift-t-settings.sh</code> and build.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_jlse_knl">JLSE KNL</h3>
<div class="paragraph"><p>These are the Knights Landing nodes at ANL/JLSE.</p></div>
<div class="paragraph"><p><strong>As of:</strong> 2017/03/09</p></div>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/icc/Python-2.7.12
~wozniak/Public/sfw/icc/mpich-3.2
~wozniak/Public/sfw/icc/tcl-8.6.6
~wozniak/Public/sfw/ant-1.10.1</code></pre>
</div></div>
<div class="paragraph"><p>The same build can be used for login and compute nodes, since the
architecture and MPI library are the same &#x1f632;.  The only potential
gotcha is loading the Intel <code>compilervars.sh</code> script to set library paths.</p></div>
<div class="sect3">
<h4 id="_public_installation_6">Public installation</h4>
<div class="paragraph"><p>Add to <code>PATH</code>: <code>~wozniakPublic/sfw/icc/swift-t/stc/bin</code></p></div>
<div class="paragraph"><p>This version is linked to Python 2.7.12.</p></div>
<div class="sect4">
<h5 id="_login_node">Login node</h5>
<div class="paragraph"><p>Run with</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ source /soft/compilers/intel/compilers_and_libraries/linux/bin/compilervars.sh intel64
$ nice swift-t workflow.swift</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_compute_node">Compute node</h5>
<div class="paragraph"><p>Run with</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ source /soft/compilers/intel/compilers_and_libraries/linux/bin/compilervars.sh intel64
$ export QUEUE=knl_7210 MODE=cluster WALLTIME=HH:MM:SS
$ swift-t -m cobalt -e LD_LIBRARY_PATH=$LD_LIBRARY_PATH workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p>The following Swift script will validate that you have 256 cores to
use:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>app processors() {
  "cat" "/proc/cpuinfo" ;
}
processors();</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_instructions_4">Build instructions</h4>
<div class="paragraph"><p>Apply</p></div>
<div class="listingblock">
<div class="content">
<pre><code>source /soft/compilers/intel/compilers_and_libraries/linux/bin/compilervars.sh</code></pre>
</div></div>
<div class="paragraph"><p>Configure ADLB and Turbine as usual, no special settings are required.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_blue_gene">Blue Gene</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Blue Gene systems at ANL are <a href="#scheduled_systems">scheduled systems</a> that use Cobalt.</p></div>
<div class="ulist"><ul>
<li>
<p>
The job ID is placed in <code>TURBINE_OUTPUT/jobid.txt</code>
</p>
</li>
<li>
<p>
Job metadata is placed in <code>TURBINE_OUTPUT/turbine-cobalt.log</code>
</p>
</li>
<li>
<p>
The Cobalt log is placed in <code>TURBINE_OUTPUT</code>
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_blue_gene_q">Blue Gene/Q</h3>
<div class="sect3">
<h4 id="_alcf">ALCF</h4>
<div class="ulist"><ul>
<li>
<p>
Run with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>export MODE=BGQ
export PROJECT=&lt;project_name&gt;
export QUEUE=&lt;queue_name&gt;
swift-t -m cobalt -n 3 program.swift</code></pre>
</div></div>
<div class="paragraph"><p>or:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export MODE=BGQ
export PROJECT=&lt;project_name&gt;
export QUEUE=&lt;queue_name&gt;
stc program.swift
turbine-cobalt-run.zsh -n 2 program.tic</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p>The normal Turbine environment variables are honored, plus the
<a href="#variables">Turbine scheduler variables</a>.</p></div>
<div class="sect4">
<h5 id="_public_installation_mira_cetus">Public installation: Mira/Cetus</h5>
<div class="paragraph"><p><strong>As of:</strong> 0.8.0 - 5/26/2015</p></div>
<div class="ulist"><ul>
<li>
<p>
Swift/T: <code>/soft/workflows/swift/T/stc/bin/swift-t</code>
</p>
</li>
<li>
<p>
STC: <code>/soft/workflows/swift/T/stc/bin/swift-t</code>
</p>
</li>
<li>
<p>
Turbine: <code>/soft/workflows/swift/T/turbine/bin/turbine</code>
</p>
</li>
<li>
<p>
Turbine/Cobalt: <code>/soft/workflows/swift/T/turbine/scripts/submit/cobalt/turbine-cobalt-run.zsh</code>
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_public_installation_vesta">Public installation: Vesta</h5>
<div class="paragraph"><p><strong>As of:</strong> 0.7.0 - 12/16/2014</p></div>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/sfw/stc/bin/stc</code>
</p>
</li>
<li>
<p>
Turbine: <code>~wozniak/Public/sfw/turbine/scripts/submit/cobalt/turbine-cobalt-run.zsh</code>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_procedure_4">Build procedure</h4>
<div class="paragraph"><p><strong>As of:</strong> 0.7.0 - 11/20/2014</p></div>
<div class="paragraph"><p><strong>Building Tcl:</strong></p></div>
<div class="paragraph"><p>The GCC installation does not support shared libraries.  Thus, you
must compile Tcl with <code>bgxlc</code>.  You must modify the Makefile to use
<code>bgxlc</code> arguments: <code>-qpic</code>, <code>-qmkshrobj</code>.  You must link with
<code>-qnostaticlink</code>.</p></div>
<div class="paragraph"><p>You may get errors that say <code>wrong digit</code>.  This is apparently a bgxlc
bug when applied to Tcl&#8217;s <code>StrToD.c</code>.  Compiling this file with <code>-O3</code> fixes
the problem.</p></div>
<div class="paragraph"><p><strong>Building Swift/T:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
Compile c-utils with <code>CC=powerpc64-bgq-linux-gcc</code>
</p>
</li>
<li>
<p>
Configure ADLB with <code>CC=mpixlc --enable-mpi-2 --enable-xlc --disable-checkpoint</code>
</p>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>CC=mpixlc
--enable-xlc
--disable-static
--with-tcl=/home/wozniak/Public/sfw/ppc64/bgxlc/dynamic/tcl-8.5.12
--with-mpi=/bgsys/drivers/V1R2M1/ppc64/comm
--with-mpi-lib-name=mpich-xl
--without-zlib
--without-hdf5
--disable-static-pkg
--disable-checkpoint</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p><strong>External scripting:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
Python
</p>
<div class="ulist"><ul>
<li>
<p>
Configure Python with BGXLC
</p>
</li>
</ul></div>
</li>
<li>
<p>
R
</p>
<div class="ulist"><ul>
<li>
<p>
Configure R with GCC as usual
</p>
</li>
<li>
<p>
Run with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>turbine-cobalt-run.zsh -e R_HOME=/path/to/R/lib64/R -e LD_LIBRARY_PATH=/path/to/R/lib64/R/lib</code></pre>
</div></div>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cray">Cray</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_stampede2">Stampede2</h3>
<div class="paragraph"><p><a href="https://www.tacc.utexas.edu/systems/stampede2">Stampede2</a> is a
KNL-based system at TACC.</p></div>
<div class="paragraph"><p>Some TACC-specific notes are <a href="https://github.com/swift-lang/swift-work/tree/master/tacc-tests">here</a>:</p></div>
<div class="sect3">
<h4 id="_public_installation_7">Public installation</h4>
<div class="sect4">
<h5 id="_compute_nodes">Compute nodes</h5>
<div class="paragraph"><p><strong>As of:</strong> 2022-05-02</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:<br />
<code>/work2/01163/wozniak/stampede2/Public/sfw/stampede2/swift-t/2022-04-25/stc/bin</code></p></div>
<div class="paragraph"><p>Set <code>QUEUE</code> and run with:<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ swift-t -m slurm workflow.swift ...</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_instructions_5">Build instructions</h4>
<div class="paragraph"><p><strong>As of:</strong> 2022-05-02</p></div>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="paragraph"><p><code>/work2/01163/wozniak/stampede2/Public/sfw/stampede2/tcl-8.6.6</code></p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Use the <code>dev/build/build-swift-t.sh</code> method.
</p>
</li>
<li>
<p>
Set <code>TCL_INSTALL</code>.
</p>
</li>
<li>
<p>
Set
<code>MPI_INCLUDE=/opt/intel/compilers_and_libraries_2018.2.199/linux/mpi/intel64/include</code>
</p>
</li>
<li>
<p>
Add any needed modules at the end of the file.
</p>
</li>
<li>
<p>
Run <code>build-swift-t.sh</code>
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_theta">Theta</h3>
<div class="paragraph"><p><a href="https://www.alcf.anl.gov/theta">Theta</a> is a Cray at ALCF.</p></div>
<div class="sect3">
<h4 id="_public_installation_8">Public installation</h4>
<div class="sect4">
<h5 id="_login_nodes">Login nodes</h5>
<div class="paragraph"><p>Add to <code>PATH</code>:<br />
<code>/projects/Swift-T/public/sfw/login/swift-t/2018-12-12/stc/bin</code></p></div>
<div class="paragraph"><p>This installation uses the Python 2.7.12 noted above.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ nice swift-t -E 'trace(42);'
trace: 42</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_2">Compute nodes</h5>
<div class="paragraph"><p>Add to <code>PATH</code>:<br /></p></div>
<div class="paragraph"><p><code>~wozniak/Public/sfw/theta/swift-t/2020-03-10/stc/bin</code></p></div>
<div class="paragraph"><p>This installation uses Python 3.6.5.3 and the R 3.4.0 noted above.</p></div>
<div class="paragraph"><p>Theta uses Cobalt/APRUN, which in Swift/T is machine type <code>theta</code>.</p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ swift-t -m theta workflow.swift</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_instructions_6">Build instructions</h4>
<div class="paragraph"><p><strong>As of:</strong> 2020-03-10</p></div>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/projects/Swift-T/public/sfw/login/mpich-3.2
/projects/Swift-T/public/sfw/compute/Python-2.7.12
/projects/Swift-T/public/sfw/compute/tcl-8.6.6
/home/wozniak/Public/sfw/theta/swig-3.0.12

# Older locations follow...
/home/wozniak/Public/sfw/theta/Python-2.7.12
/home/wozniak/Public/sfw/theta/tcl-8.6.1
/home/wozniak/Public/sfw/theta/R-3.4.0/lib64/R</code></pre>
</div></div>
<div class="paragraph"><p>Use</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ module load gcc</code></pre>
</div></div>
<div class="sect4">
<h5 id="_login_nodes_2">Login nodes</h5>
<div class="paragraph"><p>No special configuration is necessary.</p></div>
<div class="paragraph"><p>You can use the MPICH installed here:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/gpfs/mira-home/wozniak/Public/sfw/theta/mpich-3.2</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_3">Compute nodes</h5>
<div class="paragraph"><p>Use the <a href="guide.html#install_source"><code>dev/build</code> scripts</a>.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
First, if you are using dependencies in Spack,
  simply <code>module load</code> them.
</p>
</li>
<li>
<p>
Make sure that the <code>cc</code> in <code>PATH</code> is the correct compiler wrapper.
</p>
</li>
<li>
<p>
Edit <code>swift-t-settings.sh</code>
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Set: <code>CC=cc</code>
</p>
</li>
<li>
<p>
Set: <code>SWIFT_T_CHECK_MPICC=0</code>
</p>
</li>
<li>
<p>
Uncomment the <code>CRAYPE_LINK_TYPE</code> setting
</p>
</li>
<li>
<p>
Uncomment the <code>Theta:</code> section at the end
</p>
</li>
</ol></div>
</li>
<li>
<p>
Build with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>$ nice dev/build/build-swift-t.sh</code></pre>
</div></div>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_thetagpu">ThetaGPU</h3>
<div class="paragraph"><p><a href="https://www.alcf.anl.gov/theta">ThetaGPU</a> is a NVIDIA DGX at ALCF.</p></div>
<div class="sect3">
<h4 id="_public_installation_9">Public installation</h4>
<div class="sect4">
<h5 id="_compute_nodes_4">Compute nodes</h5>
<div class="paragraph"><p><strong>No Python or R:</strong></p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:<br /></p></div>
<div class="paragraph"><p><code>/projects/Swift-T/public/sfw/thetagpu/swift-t/2021-04-21/stc/bin</code></p></div>
</div>
<div class="sect4">
<h5 id="_build_instructions_7">Build instructions</h5>
<div class="paragraph"><p><strong>As of:</strong> 2021-05-13</p></div>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/projects/Swift-T/public/sfw/thetagpu/tcl-8.6.6
/home/wozniak/Public/sfw/theta/swig-3.0.12
/home/wozniak/Public/sfw/x86_64/jdk-1.8.0_291</code></pre>
</div></div>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/lus/theta-fs0/software/thetagpu/openmpi-4.0.5/bin
# The SWIG above.
# The JDK above.</code></pre>
</div></div>
<div class="paragraph"><p>In <code>swift-t-settings.sh</code>
. Set <code>TCL_INSTALL</code> to the location above.
. Set <code>CC=mpicc</code>
. Build as usual.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_blue_waters">Blue Waters</h3>
<div class="paragraph"><p>Blue Waters is a Cray XE6/XK7 at the University of Illinois at
Urbana-Champaign.</p></div>
<div class="sect3">
<h4 id="_public_installation_10">Public installation</h4>
<div class="paragraph"><p><strong>As of:</strong>  2017/09</p></div>
<div class="sect4">
<h5 id="_login_nodes_3">Login nodes</h5>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/login/swift-t/stc/bin
~wozniak/Public/sfw/login/swift-t/turbine/bin</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_5">Compute nodes</h5>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/compute/swift-t/stc/bin
~wozniak/Public/sfw/compute/swift-t/turbine/bin</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_jobs">Submitting jobs</h4>
<div class="paragraph"><p>Submit a compute job with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export QUEUE=normal CRAY_PPN=true PROJECT=&lt;project&gt;
swift-t -m cray workflow.swift</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_5">Build procedure</h4>
<div class="paragraph"><p><strong>As of:</strong>  2017/01</p></div>
<div class="paragraph"><p>Cray systems do not use <code>mpicc</code>.  We set <code>CC=gcc</code> and use compiler
flags to configure the MPI library.</p></div>
<div class="ulist"><ul>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils
CC=gcc
CFLAGS=-I/opt/cray/mpt/default/gni/mpich-gnu/5.1/include
LDFLAGS="-L/opt/cray/mpt/default/gni/mpich-gnu/5.1/lib -lmpich"</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--with-mpi=/opt/cray/mpt/default/gni/mpich-gnu/5.1</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_details">Details</h4>
<div class="paragraph"><p>Submitting jobs on Blue Waters is largely the same with with other Cray
systems. One difference is that the size of the job is specified using a
different notation.</p></div>
<div class="paragraph"><p>Blue Waters requires the submit script to specify job size using
different directives to other Cray systems.  It does not support the
<code>mpp</code> directives: trying to use an <code>mpp</code> directive may cause your job
to be rejected or stuck in the queue. The correct directive is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#PBS -l nodes=1:ppn=32</code></pre>
</div></div>
<div class="paragraph"><p>The <code>turbine-aprun-run.zsh</code> script supports Blue Waters.  You can invoke
it as follows (for a single node/32 processes per node):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>QUEUE=normal CRAY_PPN=true PPN=32 turbine-aprun-run.zsh -n 32 helloworld.tic</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_jyc">JYC</h3>
<div class="paragraph"><p>JYC is a small Cray XE6/XK7 at the University of Illinois at
Urbana-Champaign.</p></div>
<div class="sect3">
<h4 id="_public_installation_11">Public installation</h4>
<div class="sect4">
<h5 id="_login_nodes_4">Login nodes</h5>
<div class="paragraph"><p>Simply add to <code>PATH</code>: <code>~wozniak/Public/sfw/login/swift-t/stc/bin</code></p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ nice swift-t -n 8 workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p>This installation has Python 3.6.1.</p></div>
</div>
<div class="sect4">
<h5 id="_dependencies_2">Dependencies</h5>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>~wozniak/Public/sfw/Python-3.6.1rc1</code>
</p>
</li>
<li>
<p>
<code>~wozniak/Public/sfw/tcl-8.6.1</code>
</p>
</li>
<li>
<p>
<code>~wozniak/Public/sfw/login/mpich-3.2</code>
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_6">Compute nodes</h5>
<div class="paragraph"><p>Simply add to <code>PATH</code>: <code>~wozniak/Public/sfw/compute/swift-t/stc/bin</code></p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export CRAY_PPN=true
$ swift-t -n 8 workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p>This installation has Python 3.6.1.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_procedure_6">Build procedure</h4>
<div class="sect4">
<h5 id="_compute_nodes_7">Compute nodes</h5>
<div class="paragraph"><p><strong>As of:</strong>  2017/03</p></div>
<div class="paragraph"><p>(Same as Blue Waters.)</p></div>
<div class="paragraph"><p>Cray systems do not use <code>mpicc</code>.  We set <code>CC=gcc</code> and use compiler
flags to configure the MPI library.</p></div>
<div class="ulist"><ul>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils
CC=gcc
CFLAGS=-I/opt/cray/mpt/default/gni/mpich-gnu/5.1/include
LDFLAGS="-L/opt/cray/mpt/default/gni/mpich-gnu/5.1/lib -lmpich"</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--with-mpi=/opt/cray/mpt/default/gni/mpich-gnu/5.1</code></pre>
</div></div>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cori">Cori</h3>
<div class="paragraph"><p><a href="http://www.nersc.gov/users/computational-systems/cori/">Cori</a>
is a Cray XC40 at NERSC.</p></div>
<div class="paragraph"><p>Dependencies are installed in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/global/common/software/nstaff/swift-t/login/deps/mpich-3.2.1
/global/common/software/nstaff/swift-t/deps/R-3.4.0-gcc-7.3.0
/global/common/software/nstaff/swift-t/deps/swig-3.0.2
/global/common/software/nstaff/swift-t/deps/tcl-8.6.6</code></pre>
</div></div>
<div class="sect3">
<h4 id="_public_installation_12">Public installation</h4>
<div class="sect4">
<h5 id="_login_nodes_5">Login nodes</h5>
<div class="paragraph"><p><strong>As of:</strong> 2019-07-12</p></div>
<div class="paragraph"><p>This installation was configured with the Python 2.7.12 at:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/usr/common/software/python/2.7-anaconda/envs/deeplearning</code></pre>
</div></div>
<div class="paragraph"><p>and the R 3.4.0 noted above.</p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ PATH=$PATH:/global/common/software/nstaff/swift-t/login/2019-07-12/stc/bin
$ export PYTHONHOME=/usr/common/software/python/2.7-anaconda/envs/deeplearning
$ nice swift-t workflow.swift</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="cori_compute">Compute nodes</h5>
<div class="paragraph"><p><strong>As of:</strong> 2019-07-14</p></div>
<div class="paragraph"><p>This installation was configured with the Python 2.7.12 at:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/usr/common/software/python/2.7-anaconda/envs/deeplearning</code></pre>
</div></div>
<div class="paragraph"><p>and the R 3.4.0 noted above.</p></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ PATH=$PATH:/global/common/software/nstaff/swift-t/compute/2019-07-12/stc/bin
# This will be pasted into the SLURM script
$ export TURBINE_DIRECTIVE="#SBATCH -C knl,quad,cache\n#SBATCH --license=SCRATCH"
$ swift-t -m slurm workflow.swift</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_instructions_8">Build instructions</h4>
<div class="paragraph"><p><strong>As of:</strong> 2019-07-14</p></div>
<div class="paragraph"><p>Use</p></div>
<div class="listingblock">
<div class="content">
<pre><code>module load gcc</code></pre>
</div></div>
<div class="sect4">
<h5 id="_login_nodes_6">Login nodes</h5>
<div class="paragraph"><p>No special configuration is necessary.  You can use the login node
MPICH dependency noted above.</p></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_8">Compute nodes</h5>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Use the <a href="guide.html#install_source"><code>dev/build</code> scripts</a>.
</p>
</li>
<li>
<p>
Edit <code>swift-t-settings.sh</code> to enable:
</p>
<div class="listingblock">
<div class="content">
<pre><code>SWIFT_T_CUSTOM_MPI=1
MPI_DIR=/opt/cray/pe/mpt/7.7.3/gni/mpich-gnu/7.1</code></pre>
</div></div>
</li>
<li>
<p>
Put this at the bottom of <code>swift-t-settings.sh</code>:
</p>
<div class="listingblock">
<div class="content">
<pre><code>module load PrgEnv-gnu
export CRAYPE_LINK_TYPE=dynamic</code></pre>
</div></div>
</li>
<li>
<p>
Then build as usual.
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_swan">Swan</h3>
<div class="paragraph"><p>Swan is a Cray XC40 at Cray.</p></div>
<div class="paragraph"><p><strong>As of:</strong> 4/29/2015</p></div>
<div class="sect3">
<h4 id="_public_installation_13">Public installation</h4>
<div class="paragraph"><p>A public installation may be run at: <code>~p01951/Public/sfw/swift-t/stc/bin/swift-t</code></p></div>
<div class="paragraph"><p>Run with, e.g.:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export CRAY_PPN=true
swift-t -m cray -n 4 program.swift</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_supporting_software">Supporting software</h4>
<div class="ulist"><ul>
<li>
<p>
Tcl:  <code>/home/users/p01951/Public/sfw/tcl-8.6.2/bin/tclsh8.6</code>
</p>
</li>
<li>
<p>
SWIG: <code>/home/users/p01951/Public/sfw/swig-3.0.2/bin/swig</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_7">Build procedure</h4>
<div class="ulist"><ul>
<li>
<p>
Configure c-utils as usual with <code>gcc</code>.
</p>
</li>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>CC=gcc
CFLAGS=-I/opt/cray/mpt/default/gni/mpich2-gnu/48/include
LDFLAGS="-L/opt/cray/mpt/default/gni/mpich2-gnu/48/lib -lmpich"
./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>./configure --prefix=/path/to/turbine CC=gcc
--enable-custom-mpi
--with-mpi-include=/opt/cray/mpt/default/gni/mpich2-gnu/48/include
--with-mpi-lib-dir=/opt/cray/mpt/default/gni/mpich2-gnu/48/lib
--with-tcl=/home/users/p01951/Public/sfw/tcl-8.6.2</code></pre>
</div></div>
</li>
<li>
<p>
Compile STC as usual.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_raven">Raven</h3>
<div class="paragraph"><p>Raven is a Cray XE6/XK7 at Cray.</p></div>
<div class="sect3">
<h4 id="_build_procedure_8">Build procedure</h4>
<div class="ulist"><ul>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils
CC=gcc
CFLAGS=-I/opt/cray/mpt/default/gni/mpich2-gnu/46/include
LDFLAGS="-L/opt/cray/mpt/default/gni/mpich2-gnu/46/lib -lmpich"
--enable-mpi-2</code></pre>
</div></div>
</li>
<li>
<p>
In the Turbine configure step, use:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--with-mpi=/opt/cray/mpt/default/gni/mpich2-gnu/46</code></pre>
</div></div>
</li>
<li>
<p>
Use this Java when compiling/running STC: <code>/opt/java/jdk1.7.0_07/bin/java</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To run:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Set environment variables.  The normal Turbine environment
variables are honored, plus the <a href="#variables">Turbine scheduler variables</a>.
</p>
</li>
<li>
<p>
Run submit script (in <code>turbine/scripts/submit/cray</code>):
</p>
<div class="listingblock">
<div class="content">
<pre><code>turbine-aprun-run.zsh script.tcl --arg1=value1 ...</code></pre>
</div></div>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_advanced_usage">Advanced usage:</h4>
<div class="paragraph"><p>Turbine uses a PBS template file called
<code>turbine/scripts/submit/cray/turbine-aprun.sh.m4</code>.  This file is
simply filtered and submitted via <code>qsub</code>.  You can edit this file to
add additional settings as necessary.</p></div>
</div>
<div class="sect3">
<h4 id="_module">Module:</h4>
<div class="paragraph"><p>You may load Swift/T with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>module use /home/users/p01577/Public/modules
module load swift-t</code></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ibm">IBM</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_summit">Summit</h3>
<div class="paragraph"><p><a href="https://docs.olcf.ornl.gov/systems/summit_user_guide.html">Summit</a>
is an IBM system located at the Oak Ridge Leadership Computing
Facility with a theoretical peak double-precision performance
of approximately 200 PF.</p></div>
<div class="sect3">
<h4 id="_e4s_installation">E4S installation</h4>
<div class="paragraph"><p><strong>As of:</strong> 2021-06-17</p></div>
<div class="paragraph"><p>This is based on a Spack installation.  To use it, simply run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ module load e4s/20.10 stc/0.8.3
$ export PROJECT=...      # &lt;- Put your project here
$ swift-t -m lsf -E 'trace(42);'</code></pre>
</div></div>
<div class="paragraph"><p>Thanks to the OLCF staff for installing and maintaining this build.</p></div>
</div>
<div class="sect3">
<h4 id="_public_installation_14">Public installation</h4>
<div class="paragraph"><p><strong>As of:</strong> 2020-02-24</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/gpfs/alpine/world-shared/med106/sw/gcc-7.4.0/swift-t/2019-11-06/stc/bin</code></pre>
</div></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ module load spectrum-mpi
$ module load ibm-wml
$ swift-t -m lsf workflow.swift</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_instructions_9">Build instructions</h4>
<div class="paragraph"><p><strong>As of:</strong> 2020-02-24</p></div>
<div class="paragraph"><p>Dependencies are in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/sw/summit/ibm-wml/anaconda-powerai-1.6.1
/gpfs/alpine/world-shared/med106/sw/R-190927
/gpfs/alpine/world-shared/med106/sw/gcc-7.4.0/tcl-8.6.6
/ccs/home/wozniak/Public/sfw/ant-1.10.3
/usr/lib/jvm/java-1.8.0-openjdk/bin</code></pre>
</div></div>
<div class="paragraph"><p>Load modules:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ module load ibm-wml
$ module load spectrum-mpi</code></pre>
</div></div>
<div class="paragraph"><p>Use the <a href="guide.qhtml#install_source"><code>dev/build</code> scripts</a> and
build as on any other system.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_summit_dev">Summit-dev</h3>
<div class="paragraph"><p><a href="https://www.olcf.ornl.gov/for-users/system-user-guides/summitdev-quickstart-guide/#system-overview">Summit-dev</a>
is a 54-node IBM POWER8 x2 plus NVIDIA Tesla P100 x4 system at OLCF.
It uses LSF.</p></div>
<div class="sect3">
<h4 id="_public_installation_15">Public installation</h4>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/lustre/atlas/world-shared/csc249/sfw/sdev/swift-t/stc/bin
/lustre/atlas/world-shared/csc249/sfw/sdev/swift-t/turbine/bin</code></pre>
</div></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ swift-t -m lsf workflow.swift</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_instructions_10">Build instructions</h4>
<div class="paragraph"><p>First, apply the <a href="#rtld_global">RTLD_GLOBAL</a> fix to Tcl,
or use the dependency below.</p></div>
<div class="paragraph"><p>Dependencies are in:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/lustre/atlas/world-shared/csc249/sfw/sdev/ant-1.9.11
/lustre/atlas/world-shared/csc249/sfw/sdev/tcl-8.6.2
/usr/lib/jvm/java-1.7.0/bin/java</code></pre>
</div></div>
<div class="paragraph"><p>Load modules:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>module load gcc
module load spectrum-mpi/10.1.0.4-20170915
module load lsf-tools/1.0</code></pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Compile c-utils as usual.
</p>
</li>
<li>
<p>
Configure ADLB/X with <code>CC=mpicc</code> and compile
</p>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--with-mpi=/autofs/nccs-svm1_sw/summitdev/.swci/1-compute/opt/spack/20171006/linux-rhel7-ppc64le/gcc-6.3.1/spectrum-mpi-10.1.0.4-20170915-mwst4ujoupnioe3kqzbeqh2efbptssqz
--with-mpi-lib-name=mpi_ibm
--with-tcl=/lustre/atlas/world-shared/csc249/sfw/sdev/tcl-8.6.2</code></pre>
</div></div>
<div class="paragraph"><p>and compile.</p></div>
</li>
<li>
<p>
Compile STC as usual.
</p>
</li>
</ol></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cloud">Cloud</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ec2">EC2</h3>
<div class="sect3">
<h4 id="_setup">Setup</h4>
<div class="ulist"><ul>
<li>
<p>
Install <a href="http://instagram-engineering.tumblr.com/post/11399488246/simplifying-ec2-ssh-connections"><code>ec2-host</code></a> on your local system
</p>
</li>
<li>
<p>
Launch EC2 instances.
</p>
<div class="ulist"><ul>
<li>
<p>
Enable SSH among instances.
</p>
</li>
<li>
<p>
Firewall settings must allow all TCP/IP traffic for MPICH to run.
</p>
</li>
<li>
<p>
If necessary, install Swift/T
</p>
</li>
<li>
<p>
An AMI with Swift/T installed is available
</p>
</li>
</ul></div>
</li>
<li>
<p>
Use the provided script <code>turbine/scripts/submit/ec2/turbine-setup-ec2.zsh</code>.
</p>
<div class="ulist"><ul>
<li>
<p>
See the script header for usage notes
</p>
</li>
<li>
<p>
This will configure SSH settings and create a hosts file for MPICH
   and install them on the EC2 instance
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Then:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Compile your Swift script with STC.
</p>
<div class="listingblock">
<div class="content">
<pre><code>stc program.swift</code></pre>
</div></div>
</li>
<li>
<p>
Run with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>turbine -f $HOME/hosts.txt program.tic</code></pre>
</div></div>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">It is best to have a shared file system such as NFS running on
your nodes to maintain code and data (plenty of information is
available on the WWW on how to configure this).  If not, you will need
to <code>scp</code> the STC-generated <code>*.tic</code> code to each node before running
<code>turbine</code>, and you will have to be very careful about how you access
data files (Swift/T does not stage data to worker nodes or forward I/O
operations to another node).  Swift/T&#8217;s
<a href="http://swift-lang.org/Swift-T/guide.html#location">location syntax</a> may
be useful.</td>
</tr></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mac_os_x">Mac OS X</h2>
<div class="sectionbody">
<div class="paragraph"><p>Swift/T is regularly tested on the Mac.  You may use Swift/T as on any
other single system.</p></div>
<div class="ulist"><ul>
<li>
<p>
SWIG: You may use SWIG from source or the MacPorts <code>swig-tcl</code> package
</p>
</li>
<li>
<p>
MPI: You may use any MPI implementation
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_miscellaneous_notes">Miscellaneous notes</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section contains miscellaneous notes about compiling and running
Swift/T.</p></div>
<div class="sect2">
<h3 id="rtld_global">RTLD_GLOBAL</h3>
<div class="paragraph"><p>Some Python compiled packages including Numpy do not immediately work
with Swift/T, or any C code that instantiated Python through its C
interface. See
<a href="http://stackoverflow.com/questions/8302810/undefined-symbol-in-c-when-loading-a-python-shared-library">this
StackOverflow thread</a> for details.</p></div>
<div class="paragraph"><p>In Swift/T, the top-level calling C code is the Tcl interpreter.  So
to solve the problem, you make a one-line change in the Tcl source
file <code>unix/tclLoadDl.c</code> to ensure that <code>dlopenflags |= RTLD_GLOBAL</code>,
thus, it will always use<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>dlopen(..., RTLD_NOW | RTLD_GLOBAL)</code></pre>
</div></div>
<div class="paragraph"><p>For example, in Tcl 8.6.6, change line 90 to<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>if (1) {</code></pre>
</div></div>
<div class="paragraph"><p>This may also be necessary when running with OpenMPI.  The error you
will see is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>It looks like MPI_INIT failed for some reason; your parallel process is
likely to abort.  There are many reasons that a parallel process can
fail during MPI_INIT; some of which are due to configuration or environment
problems.  This failure appears to be an internal failure; here's some
additional information (which may only be relevant to an Open MPI
developer):

  ompi_mpi_init: ompi_rte_init failed
  --&gt; Returned "Error" (-1) instead of "Success" (0)

It looks like opal_init failed for some reason; your parallel process is
likely to abort.  There are many reasons that a parallel process can
fail during opal_init; some of which are due to configuration or
environment problems.  This failure appears to be an internal failure;
here's some additional information (which may only be relevant to an
Open MPI developer):

  opal_shmem_base_select failed
  --&gt; Returned value -1 instead of OPAL_SUCCESS</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archive">Archive</h2>
<div class="sectionbody">
<div class="paragraph"><p>These notes are for historical value.</p></div>
<div class="sect2">
<h3 id="_blue_gene_p">Blue Gene/P</h3>
<div class="sect3">
<h4 id="_surveyor_intrepid_challenger">Surveyor/Intrepid/Challenger</h4>
<div class="paragraph"><p>These machines were at the Argonne Leadership Computing Facility
(ALCF).  Other existing Blue Gene/P systems may be configured in a
similar way.</p></div>
<div class="sect4">
<h5 id="_public_installation_16">Public installation</h5>
<div class="ulist"><ul>
<li>
<p>
Based on trunk
</p>
</li>
<li>
<p>
STC: <code>~wozniak/Public/stc-trunk/bin/stc</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/turbine/scripts/submit/cobalt/turbine-cobalt-run.zsh -n 3 ~/program.tic</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_build_procedure_9">Build procedure</h5>
<div class="paragraph"><p>To run on the <a href="#login_node">login node</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
Install MPICH for the login nodes
</p>
</li>
<li>
<p>
Configure Tcl and c-utils with gcc
</p>
</li>
<li>
<p>
Configure ADLB with your MPICH
</p>
</li>
<li>
<p>
Configure Turbine with
</p>
<div class="listingblock">
<div class="content">
<pre><code>--enable-bgp LDFLAGS=-shared-libgcc</code></pre>
</div></div>
<div class="paragraph"><p>This makes adjustments for some Blue Gene quirks.</p></div>
</li>
<li>
<p>
Then, simply use the <code>bin/turbine</code> program to run.  Be cautious in
  your use of the login nodes to avoid affecting other users.
</p>
</li>
</ul></div>
<div class="paragraph"><p><em>To run on the compute nodes under IBM CNK:</em></p></div>
<div class="paragraph"><p>In this mode, you cannot use <code>app</code> functions to launch external
programs because CNK does not support this.  See ZeptoOS below.</p></div>
<div class="ulist"><ul>
<li>
<p>
Configure Tcl with mpixlc
</p>
</li>
<li>
<p>
Configure c-utils with gcc
</p>
</li>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--enable-xlc
CC=/bgsys/drivers/ppcfloor/comm/bin/mpixlc</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>CC=/soft/apps/gcc-4.3.2/gnu-linux/bin/powerpc-bgp-linux-gcc
--enable-custom
--with-mpi-include=/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/include</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p>To run, use <code>scripts/submit/bgp/turbine-cobalt.zsh</code>
See the script header for usage.</p></div>
<div class="paragraph"><p><em>To run on the compute nodes under ZeptoOS:</em></p></div>
<div class="ulist"><ul>
<li>
<p>
Configure Tcl with zmpicc
</p>
</li>
<li>
<p>
Configure c-utils with gcc
</p>
</li>
<li>
<p>
Configure ADLB with
</p>
<div class="listingblock">
<div class="content">
<pre><code>CC=zmpicc --enable-mpi-2</code></pre>
</div></div>
</li>
<li>
<p>
Configure Turbine with
</p>
<div class="listingblock">
<div class="content">
<pre><code>CC=/soft/apps/gcc-4.3.2/gnu-linux/bin/powerpc-bgp-linux-gcc
--enable-custom
--with-mpi-include=/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/include</code></pre>
</div></div>
</li>
</ul></div>
<div class="paragraph"><p>To run, use <code>scripts/submit/bgp/turbine-cobalt.zsh</code>
See the script header for usage.</p></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tukey">Tukey</h3>
<div class="paragraph"><p><a href="https://www.alcf.anl.gov/user-guides/tukey">Tukey</a> was a 96-node x86
cluster at the Argonne Leadership Computing Facility (ALCF).  It used
the Cobalt scheduler.</p></div>
<div class="paragraph"><p><strong>As of:</strong> Trunk, 4/9/2014</p></div>
<div class="sect3">
<h4 id="_public_installation_17">Public installation</h4>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/sfw/x86/stc/bin</code>
</p>
</li>
<li>
<p>
Turbine submit script: <code>~wozniak/Public/sfw/x86/turbine/scripts/submit/cobalt</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export MODE=cluster
export QUEUE=pubnet
export PROJECT=...
turbine-cobalt-run.zsh -n 3 program.tic</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_10">Build procedure</h4>
<div class="ulist"><ul>
<li>
<p>
Check that the system-provided MVAPICH <code>mpicc</code> is in your <code>PATH</code>
</p>
</li>
<li>
<p>
Configure c-utils with <code>gcc</code>
</p>
</li>
<li>
<p>
Configure ADLB with <code>CC=mpicc --enable-mpi-2</code>
</p>
</li>
<li>
<p>
Configure Turbine with <code>--with-launcher=/soft/libraries/mpi/mvapich2/gcc/bin/mpiexec</code>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_fusion">Fusion</h3>
<div class="paragraph"><p><a href="http://www.lcrc.anl.gov/about/fusion">Fusion</a> was a 320-node x86
cluster at ANL.  It used PBS.</p></div>
<div class="sect3">
<h4 id="_public_installation_18">Public installation</h4>
<div class="ulist"><ul>
<li>
<p>
STC: <code>~wozniak/Public/compute/stc/bin/stc</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export QUEUE=batch
$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/soft/gcc/4.7.2/lib64
$ ~wozniak/Public/sfw/compute/turbine/scripts/submit/pbs/turbine-pbs-run.zsh -n 3 program.tic</code></pre>
</div></div>
<div class="paragraph"><p>See the <a href="#variables">Turbine scheduler variables</a> and
<a href="#options">Turbine run script options</a> for additional settings.</p></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_11">Build procedure</h4>
<div class="paragraph"><p>Use GCC 4.7.2 and set <code>LD_LIBRARY_PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ which gcc
/software/gcc-4.7.2/bin/gcc
$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/software/gcc-4.7.2/lib64</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_titan">Titan</h3>
<div class="paragraph"><p><a href="https://www.olcf.ornl.gov/olcf-resources/compute-systems/titan">Titan</a>
was a Cray XK7 at the Oak Ridge Leadership Computing Facility that
used PBS+APRUN.</p></div>
<div class="sect3">
<h4 id="_public_installation_19">Public installation</h4>
<div class="sect4">
<h5 id="_dependencies_3">Dependencies</h5>
<div class="ulist"><ul>
<li>
<p>
SWIG: <code>~wozniak/Public/sfw/swig-3.0.2</code>
</p>
</li>
<li>
<p>
Tcl (login):  <code>~wozniak/Public/sfw/tcl-8.6.2</code>
</p>
</li>
<li>
<p>
Tcl (compute):<br />
<code>/lustre/atlas2/med106/world-shared/sfw/titan/compute/tcl-8.6.6</code><br />
<code># module PrgEnv-gnu</code>
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_login_nodes_7">Login nodes</h5>
<div class="paragraph"><p><strong>As of:</strong> 2018/03/05</p></div>
<div class="paragraph"><p>This installation is for use on the <a href="#login_node">login node</a>.</p></div>
<div class="paragraph"><p>Add to PATH:<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>~wozniak/Public/sfw/login/swift-t/stc/bin</code></pre>
</div></div>
<div class="paragraph"><p>Run with, e.g.:<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ nice swift-t -E 'trace("Hello world!");'</code></pre>
</div></div>
<div class="paragraph"><p>This uses:</p></div>
<div class="ulist"><ul>
<li>
<p>
MPICH: <code>~wozniak/Public/sfw/login/mpich-3.1.3</code>
</p>
</li>
</ul></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_9">Compute nodes</h5>
<div class="paragraph"><p><strong>As of:</strong> 2018-12-13</p></div>
<div class="paragraph"><p>This installation is for the general public, particularly INSPIRE and
CANDLE users.</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>/lustre/atlas2/med106/world-shared/sfw/titan/compute/swift-t/2018-12-12/stc/bin</code></pre>
</div></div>
<div class="paragraph"><p>Run with, e.g.:<br /></p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export PROJECT=...
$ export QUEUE=debug
$ export TITAN=true
$ swift-t -m cray -E 'trace("Hello world!");'</code></pre>
</div></div>
<div class="paragraph"><p>This uses:</p></div>
<div class="ulist"><ul>
<li>
<p>
Cray MPI: <code>/opt/cray/mpt/default/gni/mpich-gnu/5.1</code>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_jobs_2">Submitting jobs</h4>
<div class="paragraph"><p>Titan requires that user output goes to a Lustre file system.  Set a
soft link like this so that Turbine output goes to Lustre:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mkdir /lustre/atlas/scratch/YOUR_USERNAME/turbine-output
cd ~
ln -s /lustre/atlas/scratch/YOUR_USERNAME/turbine-output</code></pre>
</div></div>
<div class="paragraph"><p>Or, you may set <code>TURBINE_OUTPUT</code> <a href="#variables">manually</a>.</p></div>
<div class="paragraph"><p>Titan requires the submit script to specify job size using different
directives to other Cray systems.  It does not support the <code>#PBS -l ppn:</code>
directive. The correct directive is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#PBS -l nodes=2</code></pre>
</div></div>
<div class="paragraph"><p>Swift/T supports this with a special environment variable <code>TITAN=true</code>.
An example use of Swift/T on Titan is thus:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export PROJECT=...    # Some valid project
export QUEUE=debug    # or another queue
export TITAN=true
export PPN=32         # Thus 2 nodes, 32 processes per node
swift-t -m cray -n 64 workflow.swift</code></pre>
</div></div>
<div class="paragraph"><p>These environment variables may be placed in your <code>-s</code>
<a href="#options">settings file</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_12">Build procedure</h4>
<div class="paragraph"><p><strong>As of:</strong> 2018-12-13</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Use the <a href="guide.html#install_source"><code>dev/build</code> scripts</a>.
</p>
</li>
<li>
<p>
Run <code>init-settings.sh</code> as usual
</p>
</li>
<li>
<p>
Edit <code>swift-t-settings.sh</code> to set:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Set <code>SWIFT_T_PREFIX</code> to the desired installation directory
</p>
</li>
<li>
<p>
This is a Tcl compiled for the compute nodes:<br />
   <code>TCL_INSTALL=/lustre/atlas2/med106/world-shared/sfw/titan/compute/compute/tcl-8.6.6</code>
</p>
</li>
<li>
<p>
This is a Tcl compiled for the login nodes:<br />
   <code>TCLSH_LOCAL=/lustre/atlas2/med106/world-shared/sfw/titan/compute/login/tcl-8.6.6</code>+
</p>
</li>
<li>
<p>
Disable search for Python in <code>PATH</code>:<br />
   <code>ENABLE_PYTHON=0</code>
</p>
</li>
<li>
<p>
If you want Python:<br />
   <code>PYTHON_EXE=/sw/xk6/deeplearning/1.0/sles11.3_gnu4.9.3/bin/python</code><br />
   or else leave that set to empty string.
</p>
</li>
<li>
<p>
Speed up the build:<br />
   <code>MAKE_PARALLELISM=8</code>
</p>
</li>
<li>
<p>
Uncomment the <code>module load gcc</code> at the end of the script.
</p>
</li>
</ol></div>
</li>
<li>
<p>
Run:
</p>
<div class="listingblock">
<div class="content">
<pre><code>$ nice dev/build/build-swift-t.sh</code></pre>
</div></div>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_submitting_jobs_3">Submitting jobs</h4>
<div class="paragraph"><p>Titan requires the submit script to specify job size using different
directives to other Cray systems.  It does not support the <code>#PBS -l ppn:</code>
directive. The correct directive is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#PBS -l nodes=32</code></pre>
</div></div>
<div class="paragraph"><p><code>PPN</code> is handled by setting the <code>mppnppn</code> argument.</p></div>
<div class="paragraph"><p>The <code>turbine-cray.sh.m4</code> job script template supports Titan.
Use it as follows (for single node/32 processes per node):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export QUEUE=normal
export TITAN=true
export PPN=32</code></pre>
</div></div>
<div class="paragraph"><p>These environment variables may be placed in your
<a href="#settings_file">settings file</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_beagle">Beagle</h3>
<div class="paragraph"><p>Beagle is a Cray XE6 at the University of Chicago</p></div>
<div class="paragraph"><p>Remember that at run time, Beagle compute node jobs can access only
<code>/lustre</code>, not NFS (including home directories).  Thus, you must
install Turbine and its libraries in <code>/lustre</code>.  Also, your data must
be in <code>/lustre</code>.</p></div>
<div class="sect3">
<h4 id="_public_installation_20">Public installation</h4>
<div class="sect4">
<h5 id="_login_nodes_8">Login nodes</h5>
<div class="paragraph"><p><strong>As of: Swift/T 1.3.0, October 2017</strong></p></div>
<div class="paragraph"><p>This installation is for use on the <a href="#login_node">login node</a>.  It has
<a href="http://swift-lang.github.io/swift-t/guide.html#leaf_python">Python</a>
and
<a href="http://swift-lang.github.io/swift-t/guide.html#leaf_r">R</a> enabled.</p></div>
<div class="paragraph"><p>Add to <code>PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/soft/swift-t/login/2017-10/stc/bin
/soft/swift-t/login/2017-10/turbine/bin</code></pre>
</div></div>
<div class="paragraph"><p>Add to <code>LD_LIBRARY_PATH</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/soft/swift-t/deps/R-3.3.2/lib64/R/lib
/soft/swift-t/deps/Python-2.7.10/lib
/opt/gcc/4.9.2/snos/lib64</code></pre>
</div></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>nice swift-t workflow.swift</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_compute_nodes_10">Compute nodes</h5>
<div class="ulist"><ul>
<li>
<p>
Swift/T master - 2016/03/21
</p>
</li>
<li>
<p>
STC: <code>/lustre/beagle2/wozniak/Public/sfw/swift-t/py2r/stc</code>
</p>
</li>
<li>
<p>
Turbine: <code>/lustre/beagle2/wozniak/Public/sfw/swift-t/py2r/turbine</code>
</p>
</li>
<li>
<p>
This installation is configured with
  <a href="http://swift-lang.github.io/swift-t/guide.html#_calling_python">Python</a> and
  <a href="http://swift-lang.github.io/swift-t/guide.html#_calling_r">R</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To run:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Set environment variables.  The normal Turbine environment
variables are honored, plus the <a href="#variables">Turbine scheduler variables</a> and <a href="#options">Turbine scheduler options</a>..
</p>
</li>
<li>
<p>
Run Swift:
</p>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m cray -n &lt;numprocs&gt; script.swift --arg1=value1 ...</code></pre>
</div></div>
<div class="paragraph"><p>or:</p></div>
<div class="paragraph"><p>Run Turbine:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>turbine -m cray -n &lt;numprocs&gt; script.tic --arg1=value1 ...</code></pre>
</div></div>
<div class="paragraph"><p>or:</p></div>
<div class="paragraph"><p>Run the submit script directly (in <code>turbine/scripts/submit/cray</code>):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>turbine-cray-run.zsh -n &lt;numprocs&gt; script.tic --arg1=value1 ...</code></pre>
</div></div>
</li>
</ol></div>
</div>
</div>
<div class="sect3">
<h4 id="_build_procedure_13">Build procedure</h4>
<div class="paragraph"><p>Cray systems do not use <code>mpicc</code>.  We set <code>CC=gcc</code> and use compiler
flags to configure the MPI library.</p></div>
<div class="ulist"><ul>
<li>
<p>
Configure ADLB with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>$ export CFLAGS=-I/opt/cray/mpt/default/gni/mpich2-gnu/49/include
$ export LDFLAGS="-L/opt/cray/mpt/default/gni/mpich2-gnu/49/lib -lmpich"
$ ./configure --prefix=/path/to/lb --with-c-utils=/path/to/c-utils CC=gcc --enable-mpi-2</code></pre>
</div></div>
</li>
<li>
<p>
In the Turbine configure step, replace the <code>--with-mpi</code> option with:
</p>
<div class="listingblock">
<div class="content">
<pre><code>--with-mpi=/opt/cray/mpt/default/gni/mpich2-gnu/49</code></pre>
</div></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_with_mpe">Build procedure with MPE</h4>
<div class="paragraph"><p>Configure MPE 1.3.0 with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export CFLAGS=-fPIC
export MPI_CFLAGS="-I/opt/cray/mpt/default/gni/mpich2-gnu/47/include -fPIC"
export LDFLAGS="-L/opt/cray/mpt/default/gni/mpich2-gnu/47/lib -lmpich"
export F77=gfortran
export MPI_F77=$F77
export MPI_FFLAGS=$MPI_CFLAGS
CC="gcc -fPIC" ./configure --prefix=... --disable-graphics</code></pre>
</div></div>
<div class="paragraph"><p>Configure ADLB with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export CFLAGS=-mpilog
export LDFLAGS="-L/path/to/mpe/lib -lmpe -Wl,-rpath -Wl,/path/to/mpe/lib"
./configure --prefix=... CC=mpecc --with-c-utils=/path/to/c-utils --with-mpe=/path/to/mpe --enable-mpi-2</code></pre>
</div></div>
<div class="paragraph"><p>Configure Turbine with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>./configure --enable-custom-mpi --with-mpi=/opt/cray/mpt/default/gni/mpich2-gnu/47 --with-mpe=/path/to/mpe</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_blues">Blues</h3>
<div class="paragraph"><p><a href="http://www.lcrc.anl.gov/about/blues">Blues</a> is a 310-node x86
cluster at ANL.  It uses PBS.</p></div>
<div class="paragraph"><p><strong>As of:</strong> Master, 8/17/2015</p></div>
<div class="sect3">
<h4 id="_public_installation_21">Public installation</h4>
<div class="ulist"><ul>
<li>
<p>
<code>~wozniak/Public/sfw/blues/compute/stc/bin/swift-t</code>
</p>
</li>
<li>
<p>
<code>~wozniak/Public/sfw/blues/compute/turbine/bin/turbine</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>This installation has Python enabled.</p></div>
<div class="paragraph"><p>To run:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export QUEUE=batch # or other settings</code></pre>
</div></div>
<div class="paragraph"><p>See the <a href="#variables">Turbine scheduler variables</a> and
<a href="#options">Turbine run script options</a> for additional settings.</p></div>
<div class="paragraph"><p>Use <code>swift-t</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m pbs -n 8 program.swift</code></pre>
</div></div>
<div class="paragraph"><p>or Turbine:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>stc program.swift
turbine -m pbs -n 8 program.tic</code></pre>
</div></div>
<div class="paragraph"><p>or the Turbine PBS run script:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>stc program.swift
turbine-pbs-run.zsh -n 8 program.tic</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_14">Build procedure</h4>
<div class="paragraph"><p>Use GCC 4.8.2 and MVAPICH 2.0:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ PATH=/soft/gcc/4.8.2/bin:$PATH
$ which gcc
/soft/gcc/4.8.2/bin/gcc
$ PATH=/soft/mvapich2/2.0-gcc-4.7.2/bin:$PATH
$ which mpicc
/soft/mvapich2/2.0-gcc-4.7.2/bin/mpicc</code></pre>
</div></div>
<div class="paragraph"><p>A public Tcl is in: <code>&#126;wozniak/Public/sfw/tcl-8.6.4</code></p></div>
<div class="paragraph"><p>A public Python is in: <code>&#126;wozniak/Public/sfw/Python-2.7.8</code></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_breadboard">Breadboard</h3>
<div class="paragraph"><p>Cf. <a href="http://wiki.mcs.anl.gov/radix/index.php/Breadboard">Breadboard Wiki</a></p></div>
<div class="paragraph"><p>Breadboard is a cloud-ish cluster for software development in
MCS. This is a fragile resource used by many MCS developers. Do not
overuse.</p></div>
<div class="paragraph"><p>Operates as a generic cluster (see above).  No scheduler.  Once you
have the nodes, you can use them until you release them or time
expires (12 hours by default).</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Allocate nodes with <code>heckle</code>.  See Breadboard wiki
</p>
</li>
<li>
<p>
Wait for nodes to boot
</p>
</li>
<li>
<p>
Use <code>heckle allocate -w</code> for better interaction
</p>
</li>
<li>
<p>
Create MPICH hosts file:
</p>
<div class="listingblock">
<div class="content">
<pre><code>heckle stat | grep $USER | cut -f 1 -d ' ' &gt; hosts.txt</code></pre>
</div></div>
</li>
<li>
<p>
Run:
</p>
<div class="listingblock">
<div class="content">
<pre><code>export TURBINE_LAUNCH_OPTIONS='-f hosts.txt'
turbine -l -n 4 program.tic</code></pre>
</div></div>
</li>
<li>
<p>
Run as many jobs as desired on the allocation
</p>
</li>
<li>
<p>
When done, release the allocation:
</p>
<div class="listingblock">
<div class="content">
<pre><code>for h in $( cat hosts.txt )
do
  heckle free $h
done</code></pre>
</div></div>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_edison">Edison</h3>
<div class="paragraph"><p>Edison is a Cray XC30 system at NERSC.</p></div>
<div class="sect3">
<h4 id="_public_installation_22">Public Installation</h4>
<div class="paragraph"><p>A public installation may be run at: <code>/scratch2/scratchdirs/ketan/exm-install/stc/bin/swift-t</code></p></div>
<div class="paragraph"><p>Run with, e.g.:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m cray -n 4 program.swift</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_build_procedure_15">Build Procedure</h4>
<div class="paragraph"><p>Load (and unload) appropriate modules:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>module unload PrgEnv-intel darshan cray-shmem
module load PrgEnv-gnu java</code></pre>
</div></div>
<div class="paragraph"><p>Clone the latest exm code:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd $SCRATCH
git clone https://github.com/swift-lang/swift-t.git
cd swift-t</code></pre>
</div></div>
<div class="paragraph"><p>Install c-utils:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd $SCRATCH/swift-t/c-utils
./configure --enable-shared --prefix=$SCRATCH/exm-install/c-utils
make &amp;&amp; make install</code></pre>
</div></div>
<div class="paragraph"><p>Install adlb:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd $SCRATCH/swift-t/lb
CFLAGS=-I/opt/cray/mpt/default/gni/mpich2-gnu/49/include
LDFLAGS="-L/opt/cray/mpt/default/gni/mpich2-gnu/49/lib -lmpich"
./configure CC=gcc --with-c-utils=$SCRATCH/exm-install/c-utils --prefix=$SCRATCH/exm-install/lb --enable-mpi-2
make &amp;&amp; make install</code></pre>
</div></div>
<div class="paragraph"><p>Install turbine:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd $SCRATCH/swift-t/turbine
./configure --with-adlb=$SCRATCH/exm-install/lb --with-c-utils=$SCRATCH/exm-install/c-utils \
--prefix=$SCRATCH/exm-install/turbine --with-tcl=/global/homes/k/ketan/tcl-install --with-tcl-version=8.6 \
--with-mpi=/opt/cray/mpt/default/gni/mpich2-gnu/49
make &amp;&amp; make install</code></pre>
</div></div>
<div class="paragraph"><p>Install stc:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd $SCRATCH/swift-t/stc
ant install -Ddist.dir=$SCRATCH/exm-install/stc -Dturbine.home=$SCRATCH/exm-install/turbine</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_environment">Environment</h4>
<div class="paragraph"><p>Set environment. Add the following to your .bashrc.ext (or equivalent)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export PATH=$PATH:$SCRATCH/exm-install/stc/bin:$SCRATCH/exm-install/turbine/bin:$SCRATCH/exm-install/turbine/scripts/submit/cray
source ~/.bash.ext</code></pre>
</div></div>
<div class="paragraph"><p>Note that with Swift installed as a module, the above steps will disappear and the only step needed will be to load the module:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>module load swift-t
module load swift-k</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_a_simple_script">A simple script</h4>
<div class="paragraph"><p>To compile and run a simple Swift/T script over Edison Compute nodes. Following is a simple "Hello World!" script:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/**
   Example 1 - HELLO.SWIFT
*/

import io;

main
{
  printf("Hello world!");
}</code></pre>
</div></div>
<div class="paragraph"><p>Compile and run the above script using <code>swift-t</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m "cray" hello.swift</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The -m flag determines the machine type: "cray", "pbs", "cobalt", etc.</td>
</tr></table>
</div>
<div class="paragraph"><p>A Turbine Intermediate Code (.tic) file will be generated on successful compilation.
The <code>swift-t</code> command builds a job specification script and submits it to the
scheduler.</p></div>
<div class="paragraph"><p>Output from the above command will be similar to the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>TURBINE_OUTPUT=/global/homes/k/ketan/turbine-output/2015/04/30/09/09/53
`hello.tic' -&gt; `/global/homes/k/ketan/turbine-output/2015/04/30/09/09/53/hello.tic'
SCRIPT=hello.tic
PPN=1
TURBINE_OUTPUT=/global/homes/k/ketan/turbine-output/2015/04/30/09/09/53
WALLTIME=00:15:00
PROCS=2
NODES=2
wrote: /global/homes/k/ketan/turbine-output/2015/04/30/09/09/53/turbine-cray.sh
JOB_ID=2816478.edique02</code></pre>
</div></div>
<div class="paragraph"><p>Inspect the results with:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cat $TURBINE_OUTPUT/output.txt.2816478.edique02.out</code></pre>
</div></div>
<div class="paragraph"><p>The following will be the contents:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   0.000 MODE: WORK
   0.000 WORK TYPES: WORK
   0.000 WORKERS: 1 RANKS: 0 - 0
   0.000 SERVERS: 1 RANKS: 1 - 1
   0.000 WORK WORKERS: 1 RANKS: 0 - 0
   0.000 MODE: SERVER
   0.062 function:swift:constants
   0.062 enter function: __entry
Hello world!
   0.163 turbine finalizing
   0.104 turbine finalizing
Application 12141240 resources: utime ~0s, stime ~0s, Rss ~118364, inblocks ~2287, outblocks ~50</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_a_second_example">A second example</h4>
<div class="paragraph"><p>The following example joins multiple files (n times in parallel) using the Unix
<code>cat</code> utility:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import files;
import string;

app (file out) cat (file input) {
  "/bin/cat" input @stdout=out
}

foreach i in [0:9]{
  file joined&lt;sprintf("joined%i.txt", i)&gt; = cat(input_file("data.txt"));
}</code></pre>
</div></div>
<div class="paragraph"><p>Save the above script as <code>catsn.swift</code>.</p></div>
<div class="paragraph"><p>Prepare input file as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>echo "contents of data.txt"&gt;data.txt</code></pre>
</div></div>
<div class="paragraph"><p>Set TURBINE_OUTPUT to current directory:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export TURBINE_OUTPUT=$PWD</code></pre>
</div></div>
<div class="paragraph"><p>Run the script as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>swift-t -m "cray" catsn.swift</code></pre>
</div></div>
<div class="paragraph"><p>On successful compilation and job submission, output similar to the following will be produced:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>TURBINE_OUTPUT=/scratch2/scratchdirs/ketan/ATPESC_2014-08-14/swift-t/examples/catsn/turbine.work
`./swift-t-catsn.hzS.tic' -&gt; `/scratch2/scratchdirs/ketan/ATPESC_2014-08-14/swift-t/examples/catsn/turbine.work/swift-t-catsn.hzS.tic'
SCRIPT=./swift-t-catsn.hzS.tic
PPN=1
TURBINE_OUTPUT=/scratch2/scratchdirs/ketan/ATPESC_2014-08-14/swift-t/examples/catsn/turbine.work
WALLTIME=00:15:00
PROCS=2
NODES=2
wrote: /scratch2/scratchdirs/ketan/ATPESC_2014-08-14/swift-t/examples/catsn/turbine.work/turbine-cray.sh
JOB_ID=2835290.edique02</code></pre>
</div></div>
<div class="paragraph"><p>Inspect one of the output files <code>joined&lt;n&gt;.txt</code> produced in the $TURBINE_OUTPUT directory:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cat $TURBINE_OUTPUT/joined4.txt</code></pre>
</div></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.5.0<br />
Last updated
 2022-05-02 14:02:19 CST
</div>
</div>
</body>
</html>
